<!--
VISTA DE REGISTRO DE ESTABLECIMIENTOS.
Esta plantilla gestiona el alta de nuevos bares en el sistema.
Se organiza en cuatro secciones lógicas para mejorar la usabilidad
y asegurar la recolección de todos los requisitos técnicos (Spotify, GPS y Firma).
-->

<div class="register-page">
  <div class="register-card">
    
    <!-- CABECERA DE BIENVENIDA -->
    <header class="register-header">
      <h1>REGISTRO DE BAR</h1>
      <p>Configura tu cuenta y conecta tu música</p>
    </header>

    <!-- FORMULARIO PRINCIPAL: Gestionado por NgForm para validación reactiva -->
    <form (ngSubmit)="registrar()" #f="ngForm" novalidate class="register-form">
      
      <!-- SECCIÓN 1: DATOS PRINCIPALES -->
      <section class="form-section">
        <h3 class="section-title">Información del Negocio</h3>
        
        <div class="input-group">
          <label for="bar">Nombre del Bar</label>
          <input id="bar" type="text" name="bar" [(ngModel)]="bar" required placeholder="Ej: La Gramola Dorada" />
        </div>

        <div class="input-group">
          <label for="email">Correo Electrónico</label>
          <input id="email" type="email" name="email" [(ngModel)]="email" required placeholder="contacto@ejemplo.com" />
        </div>

        <div class="input-group">
          <label for="address">Dirección Física</label>
          <input id="address" type="text" name="address" [(ngModel)]="address" required placeholder="Calle, Número, Ciudad..." />
        </div>
      </section>

      
      <!-- SECCIÓN 2: INTEGRACIÓN CON SPOTIFY (DESTACADA) 
       Sección que requiere las credenciales obtenidas en el Dashboard de Spotify.
       Visualmente resaltada en el CSS para indicar su importancia.
      -->
      <section class="form-section spotify-section">
        <div class="section-header-icon">
          <!-- Icono SVG simple de candado/llave -->
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          <h3 class="section-title">Credenciales Spotify</h3>
        </div>
        
        <div class="grid-2-col">
          <div class="input-group">
            <label for="clientId">Client ID</label>
            <input id="clientId" type="text" name="clientId" [(ngModel)]="clientId" required placeholder="Pegar ID aquí" />
          </div>
          <div class="input-group">
            <label for="clientSecret">Client Secret</label>
            <input id="clientSecret" type="password" name="clientSecret" [(ngModel)]="clientSecret" required placeholder="••••••••" />
          </div>
        </div>
      </section>

      <!-- SECCIÓN 3: SEGURIDAD DE ACCESO 
       Gestión de contraseñas con validación de longitud mínima.
      -->
      <section class="form-section">
        <div class="grid-2-col">
          <div class="input-group">
            <label for="pwd1">Contraseña</label>
            <input id="pwd1" type="password" name="pwd1" [(ngModel)]="pwd1" required minlength="8" placeholder="Mínimo 8 caracteres" />
          </div>
          <div class="input-group">
            <label for="pwd2">Confirmar Contraseña</label>
            <input id="pwd2" type="password" name="pwd2" [(ngModel)]="pwd2" required minlength="8" placeholder="Repite la contraseña" />
          </div>
        </div>
      </section>

      <!-- SECCIÓN 4: FIRMA DIGITAL (REQUISITO EXTRA C)
       Implementa un panel táctil/ratón mediante HTML5 Canvas para 
       formalizar el alta del establecimiento.
      -->
      <section class="form-section signature-section">
        <div class="signature-header">
          <label>Firma del Propietario <span class="required">*</span></label>
          <button type="button" class="btn-text" (click)="clearCanvas()">Borrar firma</button>
        </div>
        
        <div class="signature-pad" [class.signed]="hasSigned">
          <canvas #signatureCanvas width="600" height="160"
                  (mousedown)="startDrawing($event)" 
                  (mousemove)="draw($event)" 
                  (mouseup)="stopDrawing()" 
                  (mouseleave)="stopDrawing()"
                  (touchstart)="startDrawing($event)"
                  (touchmove)="draw($event)"
                  (touchend)="stopDrawing()">
          </canvas>
          <!-- Marcador de posición (Placeholder) visual -->
          <div class="signature-placeholder" *ngIf="!hasSigned">
            <span>Firma en este recuadro</span>
          </div>
          <!-- Indicador visual de éxito en el trazado -->
          <div class="signature-status" *ngIf="hasSigned">✓</div>
        </div>
      </section>

      <!-- ACCIONES Y MENSAJES -->
      <div class="form-actions">
        <button class="btn-primary" type="submit" [disabled]="loading">
          <span *ngIf="!loading">Crear Cuenta</span>
          <span *ngIf="loading" class="spinner"></span>
        </button>
      </div>

      <!-- CONTENEDOR DE MENSAJES DE RETROALIMENTACIÓN -->
      <div class="message-container">
        <p *ngIf="msg" class="msg success">{{ msg }}</p>
        <p *ngIf="err" class="msg error">{{ err }}</p>
      </div>

    </form>
  </div>
</div>